<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PartyLine</title>
    <link rel="stylesheet" href="/css/partyline.css">
</head>

<body>
    <div class="sidebar">
        <div class="logo">
            <img src="/images/partyline_logo_horizontal-03.png">
        </div>
        
		<%- include('partials/partyMenu') %>

        <div class="join">
            <a href="/party">Join A New Party</a>
        </div>
    </div>
    <div class="content">
        <div class="topbar">
            <div class="userprofile">
                <a href="#">User 1 Profile</a>
                <a href="#">Settings</a>
                <a href="#">Help</a>
            </div>
            <div class="search">
				<%- include('partials/searchBar') %>
            </div>
        </div>
        <div class="main">
            <div class="sidemenu">
                <h2><%= partyName %></h2>
                <p><%= partyDescription %></p>
				<%
				let amSubscribed = false;
				for ( let i = 0; i < partyMenu.length; i++ ) {
					if ( partyMenu[i].id == partyId ) {
						amSubscribed = true;
					}
				}
				
				if ( ! amSubscribed ) { 
				%> 
				<form method="post" action="/subscribe/<%= partyId %>"><input type="submit" value="Join Party"></form>
				<% } %>
                <ul>
					<li><a href="/party/<%= partyId %>/new">Create Sub-Party</a></li>
					<%
						if ( subParties.length ) {
							for ( let i = 0; i < subParties.length; i++ ) {
					%>
					<li><a href="/party/<%= subParties[i].id %>"><%= subParties[i].name %></a></li>
					<%			
							}
						}
					%>
                </ul>

				
            </div>
            <div class="chat">
                <div class="messages">
                    <% 
                    var highestID = 0; 
                    
                    
                    for ( let i = 0; i < messages.length; i++ ) {
                        if ( messages[i].id > highestID ) {
                            highestID = messages[i].id;
                        }
                        
                        
                    %>
                    <div class="message"> 
                        <div class="username">User <%= messages[i].user_id %></div>
                        <div class="timestamp"><%= messages[i].sent_on %></div>
                        <div class="messageText"><%= messages[i].message %></div>
                    </div>
					<% } %>
                    <script> 
                    let highestID = <%= highestID %>;
                    </script>

                    <script>
                        var loadMessages = function(){
                            // make xmlhttprequest object
                            // tell xmlhttprequest where it's going
                            // write call back function 
                            // send the request
                        }
                    </script>

                </div>
                <div class="chatform">
                    <div class="newMessage">
                        <form method="post" action="/party/<%= partyId %>">
                            <label for="newMessage"></label>
                            <input type="text" id="newMessage" name="newMessage" placeholder="Message Goes Here...">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>